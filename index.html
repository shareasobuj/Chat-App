<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Ultra Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #0b141a; color: #e9edef; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        .chat-bg { background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-color: rgba(11, 20, 26, 0.95); background-blend-mode: overlay; }
        .my-msg { background-color: #005c4b; border-radius: 10px 0 10px 10px; align-self: flex-end; padding: 8px 12px; margin-bottom: 4px; }
        .friend-msg { background-color: #202c33; border-radius: 0 10px 10px 10px; align-self: flex-start; padding: 8px 12px; margin-bottom: 4px; }
        #auth-page, #list-page, #chat-page { display: none; height: 100vh; flex-direction: column; }
        .active { display: flex !important; }
    </style>
</head>
<body>

    <div id="auth-page" class="active justify-center items-center p-6">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" class="w-20 mb-8">
        <input id="email" type="email" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®" class="w-full max-w-sm p-4 rounded bg-[#2a3942] mb-3 outline-none focus:ring-2 ring-[#00a884]">
        <input id="pass" type="password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®" class="w-full max-w-sm p-4 rounded bg-[#2a3942] mb-6 outline-none focus:ring-2 ring-[#00a884]">
        <div class="flex gap-4">
            <button onclick="handleAuth('login')" class="bg-[#00a884] px-10 py-3 rounded-full font-bold">‡¶≤‡¶ó‡¶á‡¶®</button>
            <button onclick="handleAuth('signup')" class="border border-[#00a884] px-10 py-3 rounded-full font-bold">‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™</button>
        </div>
    </div>

    <div id="list-page">
        <header class="bg-[#202c33] p-4 flex justify-between items-center shadow-lg">
            <h1 class="text-xl font-bold text-[#00a884]">WhatsApp</h1>
            <div class="flex gap-5 text-[#aebac1] text-lg items-center">
                <i class="fa-solid fa-camera cursor-pointer" onclick="openProfile()"></i>
                <div class="relative">
                    <i class="fa-solid fa-ellipsis-vertical cursor-pointer p-2" onclick="document.getElementById('menu').classList.toggle('hidden')"></i>
                    <div id="menu" class="hidden absolute right-0 mt-2 w-48 bg-[#233138] shadow-2xl z-50 rounded py-2">
                        <div class="px-4 py-2 hover:bg-[#182229] cursor-pointer" onclick="openProfile()">Settings (Name/Pic)</div>
                        <div class="px-4 py-2 hover:bg-[#182229] cursor-pointer text-red-400" onclick="auth.signOut()">Logout</div>
                    </div>
                </div>
            </div>
        </header>
        <div id="user-list" class="flex-1 overflow-y-auto">
            </div>
    </div>

    <div id="chat-page">
        <header class="bg-[#202c33] p-3 flex items-center gap-3 shadow-md">
            <i class="fa-solid fa-arrow-left cursor-pointer p-2" onclick="showPage('list-page')"></i>
            <img id="c-pic" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="w-10 h-10 rounded-full object-cover">
            <div class="flex-1">
                <h2 id="c-name" class="font-bold">User</h2>
                <p class="text-[10px] text-[#00a884]">online</p>
            </div>
        </header>
        
        <div id="msg-box" class="flex-1 overflow-y-auto p-4 chat-bg flex flex-col">
            </div>

        <footer class="bg-[#202c33] p-3 flex items-center gap-2">
            <i class="fa-solid fa-plus text-[#8696a0] text-xl cursor-pointer p-2" onclick="document.getElementById('media-input').click()"></i>
            
            <input id="m-input" type="text" placeholder="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." class="flex-1 bg-[#2a3942] p-3 rounded-full px-5 outline-none text-white">
            
            <button onclick="sendMsg()" class="bg-[#00a884] w-12 h-12 rounded-full flex items-center justify-center active:scale-90 transition">
                <i class="fa-solid fa-paper-plane text-white text-lg"></i>
            </button>
        </footer>
    </div>

    <input type="file" id="p-input" class="hidden" accept="image/*">
    <input type="file" id="media-input" class="hidden" accept="image/*,video/*">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // üî• ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ API ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶®
        const firebaseConfig = {
            apiKey: "AIzaSyCDl5ewD2Q-oxslT-lmlE2AiyUtgt0iX8A",
  authDomain: "chat-app-51f1a.firebaseapp.com",
  databaseURL: "https://chat-app-51f1a-default-rtdb.firebaseio.com",
  projectId: "chat-app-51f1a",
  storageBucket: "chat-app-51f1a.firebasestorage.app",
  messagingSenderId: "714987169605",
  appId: "1:714987169605:web:26bf3586f9da2b6d52402c",
  measurementId: "G-HXW1L660ZF"
};
        

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let activeUid = null; let unsub = null;

        window.handleAuth = (t) => {
            const e = document.getElementById('email').value, p = document.getElementById('pass').value;
            if(!e || !p) return alert("Email/Pass missing!");
            if(t==='login') signInWithEmailAndPassword(auth,e,p).catch(err=>alert(err.message));
            else createUserWithEmailAndPassword(auth,e,p).then(res=>setDoc(doc(db,"users",res.user.uid),{name:e.split('@')[0],url:""})).catch(err=>alert(err.message));
        };

        onAuthStateChanged(auth, u => {
            if(u){ showPage('list-page'); loadUsers(); }
            else showPage('auth-page');
        });

        function showPage(id){
            document.querySelectorAll('div[id$="-page"]').forEach(p=>p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function loadUsers(){
            onSnapshot(collection(db,"users"),(s)=>{
                const l = document.getElementById('user-list'); l.innerHTML="";
                s.forEach(d=>{
                    if(d.id!==auth.currentUser.uid){
                        l.innerHTML += `
                        <div class="flex items-center gap-4 p-4 border-b border-[#233138] cursor-pointer hover:bg-[#2a3942]" onclick="openChat('${d.id}','${d.data().name}','${d.data().url||''}')">
                            <img src="${d.data().url||'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" class="w-14 h-14 rounded-full object-cover">
                            <div class="flex-1 border-none"><p class="font-bold text-lg">${d.data().name}</p><p class="text-sm text-gray-500 italic">‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>
                        </div>`;
                    }
                });
            });
        }

        window.openChat = (uid, n, p) => {
            activeUid = uid; showPage('chat-page');
            document.getElementById('c-name').innerText = n;
            document.getElementById('c-pic').src = p || 'https://cdn-icons-png.flaticon.com/512/149/149071.png';
            if(unsub) unsub();
            const q = query(collection(db,"messages"),orderBy("time","asc"));
            unsub = onSnapshot(q, (s)=>{
                const b = document.getElementById('msg-box'); b.innerHTML="";
                s.forEach(m=>{
                    const d = m.data();
                    if((d.f===auth.currentUser.uid && d.t===uid) || (d.f===uid && d.t===auth.currentUser.uid)){
                        let content = d.type === 'image' ? `<img src="${d.msg}" class="rounded-lg max-w-full mt-1">` : d.type === 'video' ? `<video src="${d.msg}" controls class="rounded-lg max-w-full"></video>` : `<p class="text-md">${d.msg}</p>`;
                        b.innerHTML += `<div class="${d.f===auth.currentUser.uid?'my-msg':'friend-msg'} max-w-[85%] shadow-md">${content}</div>`;
                    }
                });
                b.scrollTop = b.scrollHeight;
            });
        };

        window.sendMsg = async (type='text', data=null) => {
            const input = document.getElementById('m-input');
            const msg = data || input.value;
            if(!msg) return;
            await addDoc(collection(db,"messages"),{msg, f:auth.currentUser.uid, t:activeUid, time:Date.now(), type});
            input.value="";
        };

        document.getElementById('media-input').onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onloadend = () => sendMsg(file.type.startsWith('image') ? 'image' : 'video', reader.result);
            reader.readAsDataURL(file);
        };

        window.openProfile = () => {
            const n = prompt("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:");
            const pi = document.getElementById('p-input');
            pi.onchange = (e) => {
                const r = new FileReader();
                r.onloadend = async () => {
                    await updateDoc(doc(db,"users",auth.currentUser.uid),{name:n||"User", url:r.result});
                    alert("‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                };
                r.readAsDataURL(e.target.files[0]);
            };
            pi.click();
        };
    </script>
</body>
</html>
